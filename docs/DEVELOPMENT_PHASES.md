# ãƒ¦ãƒ‹ãƒ•ã‚©ãƒ¼ãƒ ãƒ¬ãƒ³ã‚¿ãƒ«ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚º

## å…¨ä½“æ¦‚è¦

MVPã®ç›®æ¨™: LINEã‹ã‚‰ç”³è«‹ â†’ ã‚¹ã‚¿ãƒƒãƒ•ãŒç®¡ç†ç”»é¢ã§çŠ¶æ…‹ç®¡ç†

**çŠ¶æ…‹**: `requested` â†’ `rented` â†’ `returned`

**ç™»å ´äººç‰©**: LINEãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚¹ã‚¿ãƒƒãƒ•

**ç”»é¢**:
- LINE: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œãƒ¬ãƒ³ã‚¿ãƒ«ç”³è«‹ã€
- ãƒ–ãƒ©ã‚¦ã‚¶: ã‚¹ã‚¿ãƒƒãƒ•ãŒ `/rentals` ã§ä¸€è¦§ãƒ»çŠ¶æ…‹å¤‰æ›´

---

## ãƒ•ã‚§ãƒ¼ã‚º0: æ–¹é‡å›ºå®šï¼ˆ30ã€œ60åˆ†ï¼‰âœ… å®Œäº†

**ç›®çš„**: è¿·ã‚ãªã„ã‚ˆã†ã«å‰æã‚’å›ºã‚ã‚‹

- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: Ruby on Rails 
- **ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°**: Render
- **DB**: PostgreSQL
- **çŠ¶æ…‹**: requested / rented / returned
- **ç™»å ´äººç‰©**: LINEãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚¹ã‚¿ãƒƒãƒ•
- **ç”»é¢**: LINEç”³è«‹ + ãƒ–ãƒ©ã‚¦ã‚¶ç®¡ç†

---

## ãƒ•ã‚§ãƒ¼ã‚º1: Railsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ & rentals ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆ90åˆ†ï¼‰âœ… å®Œäº†

**ç›®çš„**: æœ€ä½é™ã® Rails + DB ã‚’ç«‹ã¡ä¸Šã’ã‚‹

- [x] æ–°è¦ Rails ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
- [x] `rails db:create`
- [x] Rental ãƒ¢ãƒ‡ãƒ«ä½œæˆï¼ˆå®Ÿéš›ã®æ§‹æˆã¯ä¸‹è¨˜ï¼‰
- [x] `rails db:migrate`
- [x] `rails c` ã§ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆç¢ºèª

**å®Ÿéš›ã®ã‚«ãƒ©ãƒ æ§‹æˆ**:
```
id, customer_name, uniform_type, rental_date, return_date, price, 
created_at, updated_at, status, line_user_id, display_name, 
uniform_info, rented_at, returned_at
```

**æ³¨æ„**: `requested_at` ã‚«ãƒ©ãƒ ãŒä¸è¶³ï¼ˆãƒ•ã‚§ãƒ¼ã‚º6ã§å¿…è¦ï¼‰

---

## ãƒ•ã‚§ãƒ¼ã‚º2: ã‚¹ã‚¿ãƒƒãƒ•ç”¨ã®è¶…ã‚·ãƒ³ãƒ—ãƒ«ç®¡ç†ç”»é¢ï¼ˆ90åˆ†ï¼‰âœ… å®Œäº†

**ç›®çš„**: ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ rental ã®çŠ¶æ…‹ã‚’æ‰‹ã§ã„ã˜ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹

- [x] RentalsController ä½œæˆï¼ˆindex, updateï¼‰
- [x] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¿½åŠ : `resources :rentals, only: [:index, :update]`
- [x] index.html.erb ã§ãƒ†ãƒ¼ãƒ–ãƒ«è¡¨ç¤ºï¼ˆline_user_id, display_name, uniform_info, statusï¼‰
- [x] è¡Œã”ã¨ã«ã€Œè²¸å‡ºä¸­ã«ã™ã‚‹ã€ã€Œè¿”å´æ¸ˆã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³
- [x] update ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ status ã¨ *_at æ›´æ–°å‡¦ç†

**URL**: http://localhost:3000/rentals

---

## ãƒ•ã‚§ãƒ¼ã‚º3: Railsã‚’å¤–ã«å‡ºã›ã‚‹çŠ¶æ…‹ã«ã™ã‚‹ï¼ˆ90åˆ†ï¼‰âœ… å®Œäº†

**ç›®çš„**: HTTPS URL ã‚’æŒã£ãŸ Rails ã‚’ä¸–ã®ä¸­ã«å‡ºã™

- [x] Render ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç™»éŒ²
- [x] PostgreSQL ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
- [x] Web Service ä½œæˆãƒ»GitHubé€£æº
- [x] ç’°å¢ƒå¤‰æ•°è¨­å®šï¼ˆRAILS_ENV, RAILS_MASTER_KEY, DATABASE_URLï¼‰
- [x] ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
- [x] æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- [x] å‹•ä½œç¢ºèª

**æœ¬ç•ªURL**: https://uniform-rental.onrender.com/rentals

---

## ãƒ•ã‚§ãƒ¼ã‚º4: LINE Developers å´ã®è¨­å®šï¼ˆ90åˆ†ï¼‰ğŸ”„ æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º

**ç›®çš„**: LINE â†’ è‡ªåˆ†ã®ã‚µãƒ¼ãƒï¼ˆRailsï¼‰ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’é£›ã°ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹

**æ‰‹é †**:
1. [ ] LINE Official Account ã® Messaging API ãŒæœ‰åŠ¹ã‹ç¢ºèª
2. [ ] LINE Developers ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§å¯¾è±¡ãƒãƒ£ãƒãƒ«ã‚’é–‹ã
3. [ ] ãƒãƒ£ãƒãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ï¼ˆé•·æœŸï¼‰ã‚’ç™ºè¡Œãƒ»æ§ãˆã‚‹
4. [ ] Webhook URL ã‚’ `https://uniform-rental.onrender.com/line/webhook` ã«è¨­å®š
5. [ ] ã€ŒWebhookã‚’åˆ©ç”¨ã™ã‚‹ã€ã‚’ ON ã«ã™ã‚‹
6. [ ] è‡ªåˆ†ã®ã‚¹ãƒãƒ›ã§ãã®å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å‹ã ã¡è¿½åŠ 

**å‚è€ƒ**: å…¬å¼ã®ã€ŒGet started with the Messaging APIã€

**æ³¨æ„**: Railså´ã¯ã¾ã  `/line/webhook` ãŒç„¡ãã¦ã‚‚OKã€‚è¨­å®šã ã‘å…ˆã«æ¸ˆã¾ã›ã‚‹

---

## ãƒ•ã‚§ãƒ¼ã‚º5: Webhook ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ä½œã‚‹ï¼ˆ90åˆ†ï¼‰

**ç›®çš„**: LINE â†’ Rails ã«ã‚¤ãƒ™ãƒ³ãƒˆãŒå±Šãã“ã¨ã‚’ç¢ºèªã™ã‚‹

**æ‰‹é †**:
1. [ ] `rails g controller Line webhook` ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ä½œæˆ
2. [ ] routes.rb ã« `post 'line/webhook', to: 'line#webhook'` ã‚’è¿½åŠ 
3. [ ] LineController#webhook ã§ä»¥ä¸‹ã‚’å®Ÿè£…:
   - `request.body.read` ã‚’ `Rails.logger.info` ã«å‡ºåŠ›
   - `head :ok` ã§ 200 OK ã‚’è¿”ã™
4. [ ] ãƒ‡ãƒ—ãƒ­ã‚¤
5. [ ] LINE Developers ã®ã€Œæ¥ç¶šç¢ºèªã€ãƒœã‚¿ãƒ³ã§ 200 ç¢ºèª
6. [ ] è‡ªåˆ†ã®LINEã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ â†’ æœ¬ç•ªãƒ­ã‚°ã«ã‚¤ãƒ™ãƒ³ãƒˆJSONç¢ºèª

**ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³**: ã€ŒLINE â†’ Railsã€ãŒä¸€æœ¬ç¹‹ãŒã‚‹

---

## ãƒ•ã‚§ãƒ¼ã‚º6: ã€Œãƒ¬ãƒ³ã‚¿ãƒ«ç”³è«‹ã€ã§ rentals ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œã‚‹ï¼ˆ90åˆ†ï¼‰

**ç›®çš„**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒLINEã‹ã‚‰ç”³è«‹ã™ã‚‹ã¨ã€DBã« requested ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒ1ä»¶å¢—ãˆã‚‹

**äº‹å‰æº–å‚™**: `requested_at` ã‚«ãƒ©ãƒ è¿½åŠ 
```bash
rails generate migration AddRequestedAtToRentals requested_at:datetime
rails db:migrate
```

**å®Ÿè£…**:
1. [ ] Webhook ã® JSON ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ line_user_id ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆã‚’å–ã‚Šå‡ºã™
2. [ ] ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹ãŒã€Œãƒ¬ãƒ³ã‚¿ãƒ«ã€ã®å ´åˆã®ã¿å‡¦ç†ã™ã‚‹ if åˆ†å²
3. [ ] Rental.create! ã§ä»¥ä¸‹ã‚’ä½œæˆ:
   - line_user_id: å–å¾—ã—ãŸID
   - display_name: nilï¼ˆå¾Œã§ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—å¯èƒ½ï¼‰
   - uniform_info: "æœªé¸æŠ"
   - status: "requested"  
   - requested_at: Time.current
4. [ ] LINE Reply API ã§è¿”ä¿¡: ã€Œç”³è«‹ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ã“ã®ç”»é¢ã‚’ã‚¹ã‚¿ãƒƒãƒ•ã«ãŠè¦‹ã›ãã ã•ã„ã€‚æ³¨æ–‡ç•ªå·ã¯ã€Œ#{rental.id}ã€ã§ã™ã€

**ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³**: ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã®LINEæ“ä½œ â†’ rentalsãƒ†ãƒ¼ãƒ–ãƒ«ã«è¡Œè¿½åŠ ã€ãŒå®Œæˆ

---

## ãƒ•ã‚§ãƒ¼ã‚º7: ã‚¹ã‚¿ãƒƒãƒ•ç”»é¢ã¨é€£æºï¼ˆ90åˆ†ï¼‰

**ç›®çš„**: ãƒ–ãƒ¼ã‚¹ã§ã€Œç”³è«‹ã•ã‚ŒãŸäººã‚’è²¸å‡ºä¸­ã«æ›´æ–°ã€ã§ãã‚‹

**å®Ÿè£…**:
1. [ ] RentalsController#index ã‚’ä¿®æ­£
   - status = "requested" ã®ã‚‚ã®ã‚’ä¸Šã«è¡¨ç¤º
   - å„è¡Œã«ã€Œè²¸å‡ºä¸­ã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’é…ç½®
2. [ ] ã€Œè²¸å‡ºä¸­ã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³ã‹ã‚‰ `PATCH /rentals/:id` ã« `status=rented` ã‚’é€ä¿¡
3. [ ] update ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã§ `if params[:status] == "rented"` æ™‚ã®å‡¦ç†:
   - `rental.update!(status: "rented", rented_at: Time.current)`

**å‹•ä½œç¢ºèª**:
- LINEã‹ã‚‰ã€Œãƒ¬ãƒ³ã‚¿ãƒ«ã€â†’ DBã« requested
- /rentals ã‚’é–‹ã â†’ ç”³è«‹ãŒ1ä»¶è¦‹ãˆã‚‹  
- ãƒœã‚¿ãƒ³æŠ¼ã™ â†’ rented ã«å¤‰ã‚ã‚‹

**ãƒã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³**: ã€Œç”³è«‹ â†’ è²¸å‡ºä¸­ã€ã¾ã§ä¸€é€šã‚Šå‹•ä½œ

---

## ãƒ•ã‚§ãƒ¼ã‚º8: è¿”å´ãƒ•ãƒ­ãƒ¼ï¼ˆ90åˆ†ï¼‰

**ç›®çš„**: è¿”å´æ™‚ã« returned ã«ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

**å®Ÿè£…**:
1. [ ] RentalsController#index ã« status = "rented" ã®ä¸€è¦§ã‚‚è¡¨ç¤º
2. [ ] å„ rented è¡Œã«ã€Œè¿”å´æ¸ˆã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³ï¼ˆstatus=returned ã‚’é€ä¿¡ï¼‰
3. [ ] update ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã« `elsif params[:status] == "returned"` è¿½åŠ :
   - `rental.update!(status: "returned", returned_at: Time.current)`

**å‹•ä½œç¢ºèª**:
- ç”³è«‹ â†’ è²¸å‡ºä¸­ â†’ è¿”å´æ¸ˆã¾ã§ã€ä¸€è¦§ç”»é¢ã ã‘ã§å…¨çŠ¶æ…‹ã‚’æ“ä½œ

---

## ãƒ•ã‚§ãƒ¼ã‚º9: æœ€ä½é™ã®ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ç¾å ´ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ï¼ˆ90åˆ†ï¼‰

**ç›®çš„**: ç¾å ´ã§è©°ã¾ã‚‰ãªã„ã‚ˆã†ã«"é‹ç”¨ã§ãã‚‹ãƒ¬ãƒ™ãƒ«"ã«ã™ã‚‹

**å®Ÿè£…**:
1. [ ] RentalsController ã«ç°¡å˜ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆæ›´æ–°å¤±æ•—æ™‚ã¯flashè¡¨ç¤ºï¼‰
2. [ ] /rentals ã«ä»Šæ—¥ã®æ—¥ä»˜çµã‚Šè¾¼ã¿ or æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ è¿½åŠ 
3. [ ] ã‚¹ã‚¿ãƒƒãƒ•å‘ã‘æ‰‹é †æ›¸ä½œæˆ:
   - ãŠå®¢ã•ã‚“ã«QRã‚’èª­ã‚“ã§ã‚‚ã‚‰ã„ã€LINEã§ã€Œãƒ¬ãƒ³ã‚¿ãƒ«ã€ã¨é€ã£ã¦ã‚‚ã‚‰ã†
   - ãƒ–ãƒ¼ã‚¹ã®PC/ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ /rentals ã‚’é–‹ã
   - ç”³è«‹ä¸€è¦§ã‹ã‚‰è©²å½“ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã€Œè²¸å‡ºä¸­ã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹
   - è¿”å´æ™‚ã«ã€Œè¿”å´æ¸ˆã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³æŠ¼ä¸‹
4. [ ] æƒ³å®šãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œã‚‚è¨˜è¼‰

---

## ç¾åœ¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

- **å®Œäº†æ¸ˆã¿**: ãƒ•ã‚§ãƒ¼ã‚º0ã€œ3ï¼ˆãƒ‡ãƒ—ãƒ­ã‚¤ã¾ã§å®Œäº†ï¼‰
- **æ¬¡ã®ãƒ•ã‚§ãƒ¼ã‚º**: ãƒ•ã‚§ãƒ¼ã‚º4ï¼ˆLINE Developers å´ã®è¨­å®šï¼‰
- **æœ¬ç•ªURL**: https://uniform-rental.onrender.com/rentals
- **GitHubãƒªãƒã‚¸ãƒˆãƒª**: https://github.com/soraabe/uniform-rental

## é–‹ç™ºæ™‚é–“è¦‹ç©ã‚‚ã‚Š

- **ãƒ•ã‚§ãƒ¼ã‚º0**: æ–¹é‡æ±ºã‚ï¼ˆã€œ60åˆ†ï¼‰
- **ãƒ•ã‚§ãƒ¼ã‚º1ã€œ9**: å„90åˆ† Ã—9 â‰’ 13.5æ™‚é–“
- **1æ—¥2ã‚³ãƒï¼ˆ3æ™‚é–“ï¼‰ãƒšãƒ¼ã‚¹**: 1é€±é–“ã§MVPå®Œæˆ

## æŠ€è¡“å‚è€ƒè³‡æ–™

- **LINE Messaging API**: https://developers.line.biz/ja/docs/messaging-api/
- **Rails LINEé€£æºè¨˜äº‹**: Qiitaç­‰ã§ã€ŒRails LINE Webhookã€æ¤œç´¢
- **Render ãƒ‡ãƒ—ãƒ­ã‚¤**: https://render.com/docs/deploy-rails